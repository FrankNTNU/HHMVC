
@{
    ViewBag.Title = "Chat";
    Layout = "~/Views/Shared/HomeLayout2.cshtml";
}
@section Styles {
    <link href="~/Areas/Admin/Content/CSS/adminlte.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="~/Content/css/fontawesome-all.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">


}

<section class="pt-3">
    <header class="major"><h2 class="mb-3"><i class="fas fa-mobile-alt"></i> 線上客服</h2></header>
    <div class="col-md-10 m-auto" style="height:auto">
        <!-- DIRECT CHAT WARNING -->
        <dv class="card direct-chat direct-chat-warning">
            <div class="card-header button primary" style="cursor:default; pointer-events:none">
                <h3 class="card-title" style="color:white">聯絡客服</h3>
            </div>
            <input type="hidden" id="displayname" />

            <div class="card-body">
                <!-- Conversations are loaded here -->
                <div class="direct-chat-messages" id="chatbox" style="margin:10px; padding:10px">


                </div>
                <div class="direct-chat-msg right" id="adminbox">

                </div>
            </div>

            <div class="card-footer">
                <div class="input-group">
                    <div class="col-12 col-md-9 col-lg-10 mb-2">
                        <input type="text" name="message" placeholder="輸入訊息..." class="form-control" id="message" autocomplete="off">
                    </div>
                    <div class="col-12 col-md-3 col-lg-2">
                        <span class="input-group-append">
                            <input type="button" class="button primary fit" id="sendmessage" value="傳送" />

                        </span>
                    </div>

                </div>
            </div>
    </div>
</section>
    <!--</div>-->
    @section scripts {
        <!--Script references. -->
        <script src="~/Areas/Admin/Content/JS/angular.min.js"></script>

        <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
        <script src="~/Scripts/jquery-1.6.4.min.js"></script>
        <!--Reference the SignalR library. -->
        <script src="~/Scripts/jquery.signalR-2.4.2.min.js"></script>
        <!--Reference the autogenerated SignalR hub script. -->
        <script src="~/Areas/Admin/Content/JS/signalr-hub.js"></script>
        <!--SignalR script to update the chat page and send messages.-->
        <script src="~/signalr/hubs"></script>

        <script>

        $(function () {
            
            // Reference the auto-generated proxy for the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.
            chat.client.addNewMessageToPage = function (name, imagePath, message) {
                // Add the message to the page.
                $('#chatbox').append('\
                    <div class="direct-chat-msg" id="discussion">\
                    <div class= "direct-chat-infos clearfix">\
                    <span class="direct-chat-name float-left">' + name
                    + '</span>'
                    + '<span class="direct-chat-timestamp float-right">'
                    + Date($.now()).substring(4, 24)
                    + '</span>'
                    + '</div>'

                    + '<img class="direct-chat-img" src="/Areas/Admin/Content/UserImage/' + imagePath
                    + '">'
                    + '<div class="direct-chat-text mb-1">' + message
                    + '</div>'
                    + '</div>'
                );
            };
            // Get the user name and store it to prepend to messages.
            //$('#displayname').val(prompt('Enter your name:', ''));
            // Set initial focus to message input box.
            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#sendmessage').click(function () {
                    if ($('#message').val().trim().length != 0) {  chat.server.send(`@Session["Name"]`, `@Session["ImagePath"]`, $('#message').val());
                    // Clear text box and reset focus for next comment.
                    $('#message').val('').focus();}
                    // Call the Send method on the hub.

                });
            });
        });

        </script>
    }

