@model UI.ViewModels.ProgramPageViewModel



@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/HomeLayout2.cshtml";
}
@section Styles{
    @*<link href="~/Content/css/dietAddMeal.css" rel="stylesheet" />
        <link href="~/Content/css/stylesPlay.css" rel="stylesheet" />*@

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <link href="~/Content/css/bootstrap.min.css" rel="stylesheet" />
    <style>
    </style>
}

<header style="background-color: #fff0f0; width: 100%; padding-right: 0px " class="pt-5 pb-1 m-0 col-12">
    <div class="row" style="width: 100%; padding-right: 20px">

        <div class="col-3 col-sm-3 col-lg-2 p-2 p-0" style="text-align:center">
            <a href="~/Home2/Index"><img src="~/Areas/Admin/Content/tempimage/hLogoRed.jpg" style="max-width:90px;width:100%"></a>
        </div>
        <div class="col-8 col-sm-7 col-lg-8 p-1 align-self-center">
            <h2 style="font-size:1.8em"><i class="fas fa-pen-nib" style="width:30px"></i> 減脂計畫</h2>
        </div>

    </div>
</header><header id="header" class="m-0 p-0"></header>






<div id="mainProgramContent" class="col-8 justify-content-center" style="margin:0 auto; margin-top:2em">
    @{if (Model.HasActiveProgram)
        {
            @Html.Partial("_ShowProgramPartial", Model.ProgramView)
        }
        else
        {
            @Html.Partial("_RegisterProgramPartial", Model.RegisterView)
        }
    }
</div>



<!-- Large modal -->
<!--<button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-lg" id="btnWaterLogTemp">WaterLog Temp_Button</button>

<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">


            <div class="modal-header" style="display:flex; justify-content:center">
                <h3 class="modal-title" id="exampleModalLabel">今天喝水了嗎 <span></span></h3>
            </div>
            <div class="modal-body">
                <form id="FrmWaterLog" name="WaterLog">
                    <input type="hidden" id="MemberID" name="MemberID" value="@Model.MemberID" />
                    <div class="form-group">
                        <label for="numWaterAmount">請輸入喝水量</label>
                        <div class=" row">
                            <div class="col-10">
                                <input class="form-control fit" type="number" name="WaterAmount" id="numWaterAmount" placeholder="單位: 毫升" />
                            </div>
                            <div class="col-2">
                                <input type="button" class="btn btn-default fit" id="btnSendWaterLog" value="送出" />
                            </div>
                        </div>
                    </div>
                </form>
                <canvas id="WaterLine" height="100" width="200"></canvas>

            </div>
            <div class="modal-footer">
                <input type="button" class="btn btn-default fit" data-dismiss="modal" id="btnSendWaterLog" value="關閉" />

            </div>



        </div>

    </div>
</div>-->
<!-- Modal -->
<div class="modal fade" id="ProgramCalculating" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="programPending">計畫審核中...</h3>

            </div>
            <div class="modal-body" style="display:flex;justify-content:center">
                <img id="pendingImg" style="max-width: 100%; max-height: 100%; " src="~/Content/Images/loadingDots.gif" />
            </div>
            <div class="modal-footer">
                <p id="pendingReminder"></p>
                <input type="button" id="closeModal" value="確定" class="btn btn-default fit" />

            </div>
        </div>
    </div>
</div>


@section Scripts{


    @*-----------------Ttool built them used?--------*@
    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/Content/js/chart.min.js"></script>   @*FOR WATERLOG*@




    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>   FOR WATERLOG


    @*----------------------------------*@

    <script>
        closeModal
        $("#closeModal").click(() => {
            $("#ProgramCalculating").modal("hide")
            $("#programPending").text("計畫審核中...")

            $("#pendingImg").attr("src", "/Content/Images/loadingDots.gif")


        });


    $(function BindingJSevents() {
        $("#ProName").on("click", (e) => {
            console.log($(e.currentTarget))
            $(e.currentTarget).val("我一定要變瘦追到隔壁大樓的小花!")

        })
        $(".datepicker").datepicker({
            minDate: "+14",
            maxDate: "+180",
        });

        $("#btnSendRegister").on("click", (e) => {
            e.preventDefault()

            $("#ProgramCalculating").modal('show')
            const formData = new FormData(document.RegisterProgramForm)

            fetch('@Url.Action("RegisterProgram", "HHApi_Program")', {
                method: "POST",
                body: formData
            }).then(response => response.text()).then(data => {
                $("#mainProgramContent").html(data)
                if ($("#hiddenHasProgram").val() == "true") {
                    $("#programPending").text("恭喜你! 減脂計畫註冊成功 加油!")
                    $("#pendingImg").attr("src", "../Content/Images/ProgramImages/goodLuckImg.jpg")
                    $("#pendingReminder").text("提醒您, 我們也為您新增了一筆起始體重紀錄以及更新您的活動量紀錄 祝您好運!")
                } else {
                    $("#programPending").text("註冊失敗... 這樣減脂太不健康啦!")
                    $("#pendingImg").attr("src", "../Content/Images/ProgramImages/sorriImg.jpg")

                }

                BindingJSevents()

            })
        })

        $("#btnTerminateProgram").on("click",() => {

            if (confirm(`只剩${$("#restDays").text()}天 ${$("#currProgramName").text()} 計畫就成功了..確定要終止嗎?`))
            {

                fetch('@Url.Action("TerminateProgram", "HHApi_Program")?programId=' + $("#currProgramId").val(), {
                    method: "GET",
                 }).then(response => response.text()).then(data => {
                     $("#mainProgramContent").html(data)
                     BindingJSevents()

                 })
            }

        })

    })


     //========================BELOW WATERLOG=======================
        @*$("#btnWaterLogTemp").on("click", () => {
            fetch('@Url.Action("GetWeeklyWateLogChartDatas", "HHApi_WaterLog")?memberId=' + @Model.MemberID + '&date='+ "@Model.Today", {
                method: "GET",
            }).then(response => response.json()).then(datas => {
                RenderWeeklyWaterLogsChart_Suggested(WaterLineChar, datas.WeeklyWaterLogSuggestedRanges)
                RenderWeeklyWaterLogsChart_Gained(WaterLineChar, datas.WeeklyWaterLogGaineds)

            })

        })




    $("#btnSendWaterLog").on("click", () => {


        const formData = new FormData(document.WaterLog)

            fetch('@Url.Action("SendWaterLog", "HHApi_WaterLog")', {
                method: "POST",
                body: formData
            }).then(response => response.json()).then(updatedWaterLog => {
                RenderWeeklyWaterLogsChart_Gained(WaterLineChar, updatedWaterLog)


            })
        $("#numWaterAmount").val("");
    })

    function RenderWeeklyWaterLogsChart_Suggested(chart, datas)
    {

        chart.data.datasets[0].data = datas[0]
        chart.data.datasets[2].data = datas[1]

        chart.update();

    }



    function RenderWeeklyWaterLogsChart_Gained(chart, datas) {

        chart.data.datasets[1].data = datas
        chart.update();
    }


    var WaterLineChartEle = document.getElementById('WaterLine').getContext('2d')

        var WaterLineChar = new Chart(WaterLineChartEle, {
            type: 'line',
            data: {
                labels: ['周一', '周二','周三', '周四', 'ˋ周五', '周六', '周日'],
                datasets: [{
                    label: '建議攝取下限(單位: 毫升)',
                    backgroundColor: [
                        "rgba(220,220,220,0.3)"

                    ],
                    borderColor: [
                        'rgba(220,220,220,0)',
                    ],
                    fill: true,
                    lineTension: 0.5,
                    radius: 0
                },
                    {
                        label: '攝取量(單位: 毫升)',
                        fill: true,
                        lineTension: 0.5,
                        radius: 0,
                        backgroundColor: [
                            "rgba(0, 76, 153,0.3)"

                        ],
                        borderColor: [
                            'rgba(0, 89, 179,1)',
                        ],
                        borderWidth: 3

                    },
                    {
                        label: '建議攝取上限(單位: 毫升)',
                        backgroundColor: [
                            "rgba(220,220,220,0.3)"

                        ],
                        borderColor: [
                            'rgba(220,220,220,0)',
                        ],
                        fill: true,
                        lineTension: 0.5,
                        radius: 0,

                    }

                ]
            },

            options: {
                responsive: true,

                scale: {
                    min: 0,
                    //max: 4000,

                },
            },

        });*@


     //========================WATERLOG END=========================

    </script>


}
