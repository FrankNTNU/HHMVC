@model UI.ViewModels.ProgramPageViewModel



@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/HomeLayout2_0622.cshtml";
}
@section Styles{
    @*<link href="~/Content/css/dietAddMeal.css" rel="stylesheet" />
        <link href="~/Content/css/stylesPlay.css" rel="stylesheet" />*@

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <link href="~/Content/css/bootstrap.min.css" rel="stylesheet" />
    <style>
    </style>
}

<header style="background-color: #fff0f0; width: 100%; padding-right: 0px " class="pt-5 pb-1 m-0 col-12">
    <div class="row" style="width: 100%; padding-right: 20px">

        <div class="col-4 col-sm-4 col-md-3 col-lg-2 p-2 p-0" style="text-align:center">
            <a href="/Home2/Index"><img src="~/Areas/Admin/Content/tempimage/hLogoRed.jpg" style="max-width:90px;width:100%"></a>
        </div>


    </div>
</header><header id="header" class="m-0 p-0"></header>







         <div id="mainProgramContent" class="col-8 justify-content-center" style="margin:0 auto; margin-top:2em">
             @{if (Model.HasActiveProgram)
                 {
                     @Html.Partial("_ShowProgramPartial", Model.ProgramView)
                 }
                 else
                 {
                     @Html.Partial("_RegisterProgramPartial", Model.RegisterView)
                 }     
             }
         </div>



<!-- Large modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-lg" id="btnWaterLogTemp">WaterLog Temp_Button</button>

<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">


            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">我的水Log <span></span></h5>
            </div>
            <div class="modal-body">
                <form id="FrmWaterLog" name="WaterLog">
                    <input type="hidden" id="MemberID" name="MemberID" value="@Model.MemberID" />
                    <div class="form-group">
                        <label for="numWaterAmount">喝水量</label>
                        <input class="form-control" type="number" name="WaterAmount" id="numWaterAmount" placeholder="mL" />
                    </div>
                </form>
                <button type="button" class="btn btn-default" id="btnSendWaterLog">送出</button>
                <canvas id="WaterLine" height="100" width="200"></canvas>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">關閉</button>
            </div>



        </div>

    </div>
</div>



@*<button onclick="test()">test</button>*@

@section Scripts{


    @*-----------------Ttool built them used?--------*@
    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
    <script src="~/Content/js/chart.min.js"></script>   @*FOR WATERLOG*@




    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>   @*FOR WATERLOG*@


    @*----------------------------------*@

    <script>
    

    $(function BindingJSevents() {

        $(".datepicker").datepicker({
            minDate: "+14",
            maxDate: "+180",
        });

        $("#btnSendRegister").on("click", (e) => {
            e.preventDefault()

            const formData = new FormData(document.RegisterProgramForm)

            fetch('@Url.Action("RegisterProgram", "HHApi_Program")', {
                method: "POST",
                body: formData
            }).then(response => response.text()).then(data => {
                $("#mainProgramContent").html(data)
                BindingJSevents()

            })
        })

        $("#btnTerminateProgram").on("click",() => {

            if (confirm(`只剩${$("#restDays").text()}天 ${$("#currProgramName").text()} 計畫就成功了..確定要終止嗎?`))
            {

                fetch('@Url.Action("TerminateProgram", "HHApi_Program")?programId=' + $("#currProgramId").val(), {
                    method: "GET",
                 }).then(response => response.text()).then(data => {
                     $("#mainProgramContent").html(data)
                     BindingJSevents()

                 })
            }

        })

    })


     //========================BELOW WATERLOG=======================
        $("#btnWaterLogTemp").on("click", () => {
            fetch('@Url.Action("GetWeeklyWateLogChartDatas", "HHApi_WaterLog")?memberId=' + @Model.MemberID + '&date='+ "@Model.Today", {
                method: "GET",
            }).then(response => response.json()).then(datas => {
                RenderWeeklyWaterLogsChart_Suggested(WaterLineChar, datas.WeeklyWaterLogSuggestedRanges)
                RenderWeeklyWaterLogsChart_Gained(WaterLineChar, datas.WeeklyWaterLogGaineds)

            })

        })




    $("#btnSendWaterLog").on("click", () => {


        const formData = new FormData(document.WaterLog)

            fetch('@Url.Action("SendWaterLog", "HHApi_WaterLog")', {
                method: "POST",
                body: formData
            }).then(response => response.json()).then(updatedWaterLog => {
                RenderWeeklyWaterLogsChart_Gained(WaterLineChar, updatedWaterLog)


            })
        $("#numWaterAmount").val("");
    })

    function RenderWeeklyWaterLogsChart_Suggested(chart, datas)
    {

        chart.data.datasets[0].data = datas[0]
        chart.data.datasets[2].data = datas[1]

        chart.update();

    }



    function RenderWeeklyWaterLogsChart_Gained(chart, datas) {

        chart.data.datasets[1].data = datas
        chart.update();
    }


    var WaterLineChartEle = document.getElementById('WaterLine').getContext('2d')

        var WaterLineChar = new Chart(WaterLineChartEle, {
            type: 'line',
            data: {
                labels: ['Mon','Tue','Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [{
                    label: '建議攝取量下限 (單位: 毫升):',
                    fillColor: "rgba(220,220,220,0.1)",
                    strokeColor: "rgba(220,220,220,0.1)",
                    pointColor: "rgba(220,220,220,0.1)",
                    pointStrokeColor: "rgba(220,220,220,0.1)",
                    fill: true,
                    lineTension: 0.4,
                    radius: 2
                    //borderWidth: 1
                },
                    {
                        label: '攝取量 (單位: 毫升):',
                        fillColor: 'rgba(130, 192, 192,0.2)',
                        strokeColor: 'rgba(130, 192, 192,0.2)',
                        pointColor: 'rgba(130, 192, 192,0.2)',
                        pointStrokeColor: 'rgba(130, 192, 192,0.2)',
                        fill: true,
                        lineTension: 0.4,
                        radius: 2,
                        backgroundColor: [
                            'rgba(57, 200, 219,0.2)'

                        ],
                        //borderWidth: 1
                    },
                    {
                        label: '建議攝取量上限 (單位: 毫升):',
                        //data: [20, 80, 60, 90, 30, 50, 60],
                        fillColor: "rgba(220,220,220,0.1)",
                        strokeColor: "rgba(220,220,220,0.1)",
                        pointColor: "rgba(220,220,220,0.1)",
                        pointStrokeColor: "rgba(220,220,220,0.1)",
                        fill: true,
                        lineTension: 0.4,
                        radius: 2

                        //borderWidth: 1
                    }

                ]
            },

            options: {
                responsive: true,

                scale: {
                    min: 0,
                    max: 4000,

                },
            },

        });


     //========================WATERLOG END=========================

    </script>


}
