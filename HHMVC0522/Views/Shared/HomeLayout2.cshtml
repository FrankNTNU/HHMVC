@using DTO
@{ Layout = null; }

<!DOCTYPE HTML>
<!--
    Editorial by HTML5 UP
    html5up.net |
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>HealthHelper 你的健康管理助手</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="~/Content/css/main.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    @*for waterLog*@
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <link href="~/Content/css/bootstrap.min.css" rel="stylesheet" />
    @*for waterLog Above*@
    @RenderSection("Styles", required: false)
    <style>
        a.toggle {
            color: red;
        }

        a {
            border-bottom: none;
        }

        img {
            border-radius: 15px 15px;
        }

        #sidebar {
            width: 15em;
            padding: 10px;
        }

        nav {
            padding: 15px;
        }

        #sidebar.inactive {
            margin-left: -15em;
        }

        #sidebar .toggle {
            left: 15em;
        }

        #sidebar > .inner {
            width: 15em;
            position: absolute;
            background-color: #fffcfc;
        }
    </style>
</head>

<body class="is-preload">
    <!-- Wrapper -->
    <div id="wrapper">
        <!-- Main -->
        <div id="main">
            <div class="inner">

                @RenderBody()
            </div>
        </div>

        <!-- Sidebar -->
        <div id="sidebar" class="p-0 w-auto">
            <div class="inner">

                <!-- Search -->
                <!-- Menu -->
                <nav id="menu" style="margin:0px">
                    <header class="major">
                        <h2>選單</h2>
                    </header>
                    <ul style="font-size: 1.3em;">
                        <li><a href="~/Home2/Index" style="text-decoration:none"><i class="fas fa-home" style="width:30px"></i> 首頁</a></li>
                        @if (Session["ID"] == null)
                        {
                            <li><a href="~/Home2/Login" style="text-decoration:none"> <i class="fas fa-user" style="width:30px"></i> 登入</a></li>
                        }
                        else
                        {



                            <li>
                                <span class="opener"><i class="fas fa-user" style="width:30px"></i> 會員</span>
                                <ul>
                                    <li><a href="#" style="text-decoration:none"><i class="far fa-user" style="width:30px"></i> 會員資訊</a></li>
                                    <li><a href="#" style="text-decoration:none"><i class="fas fa-weight" style="width:30px"></i> 體重管理</a></li>
                                    <li><a href="~/HHHealthReport/HealthReport" style="text-decoration:none"><i class="fas fa-chart-bar" style="width:30px"></i> 我的綜合圖表</a></li>


                                </ul>

                            </li>
                        }
                        <li><a href="~/Home2/Index" style="text-decoration:none"><i class="fas fa-book" style="width:30px"></i> 遊戲規則</a></li>


                        @if (Session["ID"] != null)
                        {

                            <li>
                                <span class="opener"><i class="fas fa-utensils" style="width:30px"></i> 飲食</span>
                                <ul>

                                    <li><a href="~/HHDiet/Create" style="text-decoration:none"><i class="fas fa-pen" style="width:30px"></i> 紀錄飲食</a></li>

                                    <li><a href="~/HHDietHistory/DietLogsHistory" style="text-decoration:none"><i class="fas fa-history" style="width:30px"></i> 飲食歷史</a></li>

                                </ul>

                            </li>

                            <li>
                                <span data-toggle="modal" data-target=".bd-example-modal-lg" id="btnWaterLogTemp"><i class="fas fa-utensils" style="width:30px"></i> 補水計畫</span>


                            </li>
                            <li>
                                <span class="opener"><i class="fas fa-dumbbell" style="width:30px"></i> 運動</span>
                                <ul>

                                    <li><a href="~/FrontGift/GiftList" style="text-decoration:none"><i class="fas fa-history" style="width:30px"></i> 運動紀錄</a></li>

                                    <li><a href="~/FrontGift/GiftCart?userID=@Session["ID"]" style="text-decoration:none"><i class="fas fa-calendar" style="width:30px"></i> 運動排程</a></li>
                                    <li><a href="~/FrontGift/GiftCart?userID=@Session["ID"]" style="text-decoration:none"><i class="fas fa-heart" style="width:30px"></i> 喜好管理</a></li>


                                </ul>

                            </li>

                            <li>
                                <span class="opener"><i class="fas fa-fist-raised" style="width:30px"></i> 挑戰</span>
                                <ul>

                                    <li><a href="~/HHPrograms/RegisterProgram" style="text-decoration:none"><i class="fas fa-pen-nib" style="width:30px"></i> 挑戰計畫</a></li>



                                </ul>

                            </li>
                        }



                        <li>
                            <span class="opener"><i class="fas fa-gifts" style="width:30px"></i> 禮物</span>
                            <ul>
                                <li><a href="~/FrontGift/GiftList" style="text-decoration:none"><i class="fas fa-gift" style="width:30px"></i> 禮物店</a></li>
                                @if (Session["ID"] != null)
                                {
                                    <li><a href="~/FrontGift/GiftCart?userID=@Session["ID"]" style="text-decoration:none"><i class="fas fa-shopping-cart" style="width:30px"></i> 已兌換禮物</a></li>
                                }

                            </ul>

                        </li>
                        <li>
                            <span class="opener"><i class="fas fa-file" style="width:30px"></i> 貼文</span>
                            <ul>
                                <li><a href="~/FrontPost/AllPosts" style="text-decoration:none"><i class="far fa-file" style="width:30px"></i> 所有貼文</a></li>
                                @if (Session["ID"] != null)
                                {

                                    <li><a href="~/FrontPost/UserPostList" style="text-decoration:none"><i class="fas fa-user-edit" style="width:30px"></i> 我的貼文</a></li>
                                }
                            </ul>
                        </li>
                        @if (Session["ID"] != null)
                        {
                            <li><a href="~/FrontContact/Chat" style="text-decoration:none"><i class="fas fa-comments" style="width:30px"></i> 聯絡我們</a></li>
                        }

                        @if (Session["ID"] != null)
                        {
                            <li><a href="~/Admin/Login/Index" style="text-decoration:none"><i class="fas fa-user-cog" style="width:30px"></i> 後台</a></li>
                        }

                        @if (Session["ID"] != null)
                        {
                            <li><a href="~/Home2/Logout" style="text-decoration:none"><i class="fas fa-sign-out-alt" style="width:30px"></i> 登出</a></li>
                        }

                    </ul>
                </nav>



            </div>
        </div>




    </div>
    <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">


                <div class="modal-header" style="display:flex; justify-content:center">
                    <h3 class="modal-title" id="exampleModalLabel">今天喝水了嗎 <span></span></h3>
                </div>
                <div class="modal-body">
                    <form id="FrmWaterLog" name="WaterLog">
                        <input type="hidden" id="MemberID" name="MemberID" value="@Session["ID"]" />
                        <div class="form-group">
                            <label for="numWaterAmount">請輸入喝水量</label>
                            <div class=" row">
                                <div class="col-10">
                                    <input class="form-control fit" type="number" name="WaterAmount" id="numWaterAmount" placeholder="單位: 毫升" />
                                </div>
                                <div class="col-2">
                                    <input type="button" class="btn btn-default fit" id="btnSendWaterLog" value="送出" />
                                </div>
                            </div>
                        </div>
                    </form>
                    <canvas id="WaterLine" height="100" width="200"></canvas>

                </div>
                <div class="modal-footer">
                    <input type="button" class="btn btn-default fit" data-dismiss="modal" id="btnSendWaterLog" value="關閉" />

                </div>



            </div>

        </div>
    </div>

    <!-- Scripts -->

    <script src="~/Content/js/jquery.min.js"></script>
    <script src="~/Content/js/browser.min.js"></script>
    <script src="~/Content/js/breakpoints.min.js"></script>
    <script src="~/Content/js/util.js"></script>
    <script src="~/Content/js/main.js"></script>
    @*for waterLog*@
    <script src="~/Content/js/chart.min.js"></script>   @*FOR WATERLOG*@

    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>   @*FOR WATERLOG*@


    

    <script>

        //========================BELOW WATERLOG=======================
    $("#btnWaterLogTemp").on("click", () => {
            fetch('@Url.Action("GetWeeklyWateLogChartDatas", "HHApi_WaterLog")?memberId=' +@Session["ID"] + '&date='+ "@DateTime.Now.ToString(CDictionary.MMddyyyy)", {
                method: "GET",
            }).then(response => response.json()).then(datas => {
                RenderWeeklyWaterLogsChart_Suggested(WaterLineChar, datas.WeeklyWaterLogSuggestedRanges)
                RenderWeeklyWaterLogsChart_Gained(WaterLineChar, datas.WeeklyWaterLogGaineds)

            })

        })




    $("#btnSendWaterLog").on("click", () => {


        const formData = new FormData(document.WaterLog)

            fetch('@Url.Action("SendWaterLog", "HHApi_WaterLog")', {
                method: "POST",
                body: formData
            }).then(response => response.json()).then(updatedWaterLog => {
                RenderWeeklyWaterLogsChart_Gained(WaterLineChar, updatedWaterLog)


            })
        $("#numWaterAmount").val("");
    })

    function RenderWeeklyWaterLogsChart_Suggested(chart, datas)
    {

        chart.data.datasets[0].data = datas[0]
        chart.data.datasets[2].data = datas[1]

        chart.update();

    }



    function RenderWeeklyWaterLogsChart_Gained(chart, datas) {

        chart.data.datasets[1].data = datas
        chart.update();
    }


    var WaterLineChartEle = document.getElementById('WaterLine').getContext('2d')

        var WaterLineChar = new Chart(WaterLineChartEle, {
            type: 'line',
            data: {
                labels: ['周一', '周二','周三', '周四', 'ˋ周五', '周六', '周日'],
                datasets: [{
                    label: '建議攝取下限(單位: 毫升)',
                    backgroundColor: [
                        "rgba(220,220,220,0.3)"

                    ],
                    borderColor: [
                        'rgba(220,220,220,0)',
                    ],
                    fill: true,
                    lineTension: 0.5,
                    radius: 0
                },
                    {
                        label: '攝取量(單位: 毫升)',
                        fill: true,
                        lineTension: 0.5,
                        radius: 0,
                        backgroundColor: [
                            "rgba(0, 76, 153,0.3)"

                        ],
                        borderColor: [
                            'rgba(0, 89, 179,1)',
                        ],
                        borderWidth: 3

                    },
                    {
                        label: '建議攝取上限(單位: 毫升)',
                        backgroundColor: [
                            "rgba(220,220,220,0.3)"

                        ],
                        borderColor: [
                            'rgba(220,220,220,0)',
                        ],
                        fill: true,
                        lineTension: 0.5,
                        radius: 0,

                    }

                ]
            },

            options: {
                responsive: true,

                scale: {
                    min: 0,
                    //max: 4000,

                },
            },

        });


     //========================WATERLOG END=========================
    </script>




    @*for waterLog Above*@





    @RenderSection("Scripts", required: false)




</body>
</html>