@using UI.Controllers

@{ Layout = null; }

<!DOCTYPE HTML>
<!--
    Editorial by HTML5 UP
    html5up.net |
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
<head>
    <title>HealthHelper 你的健康管理助手</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

    <link rel="stylesheet" href="~/Content/css/main.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="~/Content/jquery-ui/jquery-ui-1.12.1.custom/jquery-ui.min.css" rel="stylesheet" />
    <link href="~/Content/jquery-ui-scrollbar/jquery.scrollbar.css" rel="stylesheet" />

    @RenderSection("Styles", required: false)

    <style>
    @*恩旗=====================================*@
    #dialogDiv, #programFrozen, #fanfare {
        display: none;
    }

    #resultWeight {
        display: inline-block;
        width: 10em;
    }

    #dialogDiv ul {
        list-style-type: none;
    }

    #dialogDiv ul li::before {
        content: "\2022"; /* Add content: \2022 is the CSS Code/unicode for a bullet */
        color: #f56a6a; /* Change the color */
        font-weight: bold; /* If you want it to be bold */
        display: inline-block; /* Needed to add space between the bullet and the text */
        width: 1em; /* Also needed for space (tweak if needed) */
        margin-left: -1em; /* Also needed for space (tweak if needed) */
    }

    .no-close .ui-dialog-titlebar-close {
        display: none;
    }

    .btnOK {
        all: initial;
        border: none !important;
    }

    .ui-dialog-titlebar {
        background-color: #f56a6a;
        color: white;
    }

    .points {
        font-size: 1.5em;
        font-weight: 600;
        font-style: italic;
        color: #f56a6a;
    }

    .programSuccessPts {
        font-size: 3em;
        font-weight: 600;
        font-style: italic;
        color: #f56a6a;
    }

    @*ForCustomerService==========================*@

    #chatPanel {
        width: 300px;
        height: 400px;
        position: fixed;
        bottom: 20px;
        right: 20px;
        border: solid 1px #f56a6a;
        border-radius: 0.9em;
        transition: height linear 0.5s;
        display: flex;
        flex-direction: column;
        padding: 0px;
        overflow: hidden;
        background-color: white;
        box-shadow: 5px 5px 10px 5px #E0E0E0;
    }

    .chatHeader {
        display: flex;
        padding: 10px;
        background-color: #f56a6a;
        color: white;
        margin:0px;
    }

    #notRead {
        visibility:hidden;
        margin-left: auto;
        background-color: white;
        color: #f56a6a;
        padding: 5px 7px;
        line-height: 1em;
        height: calc(1em + 10px);
        text-align: center;
    }

    .notReadText {
        width:80%;
        text-align:center;
        font-size:0.5em;
        color:white;
        background-color: lightgray;
        border-radius:5px;
        margin: 5px auto;
    }

    #collapse {
        background-color: white;
        color: #f56a6a;
        padding: 5px;
        line-height: 1em;
        height: calc(1em + 10px);
        text-align: center;
    }

    #closePanel {
        background-color: white;
        color: #f56a6a;
        padding: 5px 7px;
        line-height: 1em;
        height: calc(1em + 10px);
        text-align: center;
    }

    .chatBody {
        border-bottom: solid 1px gray;
        flex-basis: 100%;
        background-color:white;
    }

    .scrollbar-outer.service-chat-box {
        height: 290px;
    }

    #serviceChatBox {
        position: relative;
        height: 290px;
        overflow: auto;
        scroll-behavior: smooth;
    }

    .messageRow {
        display:flex;
        flex-wrap:wrap;
        margin:5px;
    }

    .chatFooter {
        display: flex;
        margin-top: auto;
        column-gap: 10px;
        padding: 10px;
        background-color:white;
    }

    .chatFooter input, .chatFooter div {
        display: inline-block;
    }

    img.myImage {
        width:30px;
        height:30px;
    }

    .myImage, .selfText, .otherText {
        display:inline-block;
        border-radius: 5px;
        margin:5px;
    }

    .selfText, .otherText {
        position: relative;
        padding: 5px;
    }

    .selfText::before {
        content: "\25C2";
        color: plum;
        position:absolute;
        left:-9px;
    }

    .otherText::after {
        content: "\25B8";
        color: #f56a6a;
        position: absolute;
        right: -9px;
    }

    @*============================================*@

        a.toggle {
            color: red;
        }

        a {
            border-bottom: none;
        }
        img {
            border-radius: 15px 15px;
        }

        #sidebar {
            width: 15em;
            padding: 10px;
        }

        nav{
            padding:15px;
        }

        #sidebar.inactive {
            margin-left: -15em;
        }

        #sidebar .toggle {
            left: 15em;
        }
    #sidebar > .inner {
        width: 15em;
        position:absolute;
        background-color:white;

    }
    </style>
</head>

<!--恩旗-->
@if (Session["ID"] != null)
{
    if (Session["dialogShown"] == null)
    {
        Session["dialogShown"] = false;
    }
    else
    {
        Session["dialogShown"] = true;
    }

    if (!(bool)Session["dialogShown"])
    {
        var controller = ViewContext.Controller as Controller;
        Home2Controller.SetWeightLogSession(controller.HttpContext);
        Home2Controller.SetPreferencesSession(controller.HttpContext);
        Home2Controller.SetPointsSession(controller.HttpContext);
        Home2Controller.SetProgramFrozenSession(controller.HttpContext);
        Home2Controller.SetInProgramSession(controller.HttpContext);
    }
}

<!--================================================================-->

<body class="is-preload">
    <!-- Wrapper -->
    <div id="wrapper">
        <!-- Main -->
        <div id="main">
            <div class="inner">
                <!-- Header -->
                @*<header id="header" style="background-color: #fff0f0; width: 100%; padding-right: 0px " class="pt-5 pb-1 m-0 col-12">
                        <div class="row col-12 d-flex" style="width: 100%; padding-right: 0px">

                            <div class="col-4 col-sm-4 col-lg-2 p-2" style="text-align:center">
                                <a href="/Home2/Index"><img src="~/Areas/Admin/Content/tempimage/hLogoRed.jpg" style="max-width:100px;width:100%"></a>
                            </div>
                            <div class="col-8 col-sm-8 col-lg-10 p-1 justify-content-center">
                                <a href="/Home2/Index" class="logo" style="text-decoration: none;">
                                    <div class="h-50">
                                        <strong id="logoText" style="font-size:1.7em;font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">HealthHelper</strong>
                                    </div>

                                    <div class="h-50" style="font-size:1.5em">健康管理助手</div>
                                </a>
                            </div>
                        </div>
                    </header>*@
                @RenderBody()
            </div>
        </div>

        <!-- Sidebar -->
        <div id="sidebar" class="p-0 w-auto">
            <div class="inner">

                <!-- Search -->
                <!-- Menu -->
                <nav id="menu" style="margin:0px">
                    <header class="major">
                        <h2>選單</h2>
                    </header>
                    <ul style="font-size: 1.3em;">
                        <li><a href="~/Home2/Index" style="text-decoration:none"><i class="fas fa-home" style="width:30px"></i> 首頁</a></li>
                        @if (Session["ID"] == null)
                        {
                            <li><a href="~/Home2/Login" style="text-decoration:none"> <i class="fas fa-user" style="width:30px"></i> 登入</a></li>
                        }
                        else
                        {
                            <li>
                                <span class="opener"><i class="fas fa-user" style="width:30px"></i> 會員</span>
                                <ul>
                                    <li><a href="#" style="text-decoration:none"><i class="fas fa-gift" style="width:30px"></i> 會員資訊</a></li>
                                    <li>
                                        <a href="~/Weight/WeightLog" style="text-decoration:none; display:inline-block; position:relative"><i class="fas fa-weight" style="width:30px"></i> 體重管理</a>
                                        @if (Session["NoWeightLog"] != null && (bool)Session["NoWeightLog"])
                                        {   //if last 7 days has no weightlog, show this icon
                                            <i id="weightNotify" class="fa fa-comment" style="color:#f56a6a; display:inline-block; position:relative; top:-7px; left:-3px"></i>
                                        }
                                    </li>
                                    <li><a href="#" style="text-decoration:none"><i class="fas fa-chart-area" style="width:30px"></i> 我的綜合圖表</a></li>


                                </ul>

                            </li>
                        }
                        <li><a href="~/Home2/Index" style="text-decoration:none"><i class="fas fa-book" style="width:30px"></i> 遊戲規則</a></li>


                        @if (Session["ID"] != null)
                        {

                            <li>
                                <span class="opener"><i class="fas fa-utensils" style="width:30px"></i> 飲食</span>
                                <ul>

                                    <li><a href="#" style="text-decoration:none"><i class="fas fa-pen" style="width:30px"></i> 紀錄飲食</a></li>

                                    <li><a href="~/FrontGift/GiftCart?userID=@Session["ID"]" style="text-decoration:none"><i class="fas fa-history" style="width:30px"></i> 飲食歷史</a></li>

                                </ul>

                            </li>


                            <li>
                                <span class="opener"><i class="fas fa-dumbbell" style="width:30px"></i> 運動</span>
                                <ul>

                                    <li><a href="~/Workout/WorkoutLog" style="text-decoration:none"><i class="fas fa-clipboard-list" style="width:30px"></i> 運動紀錄</a></li>
                                    <li><a href="~/Workout/WorkoutSchedule" style="text-decoration:none"><i class="fas fa-running" style="width:30px"></i> 運動排程</a></li>
                                    <li>
                                        <a href="~/Workout/WorkoutPreferences" style="text-decoration:none; display:inline-block; position:relative"><i class="fas fa-star" style="width:30px"></i> 喜好管理</a>
                                        @if (Session["NoPreferences"] != null && (bool)Session["NoPreferences"])
                                        {   //if last 7 days has no weightlog, show this icon
                                            <i id="preferencesNotify" class="fa fa-comment" style="color:#f56a6a; display:inline-block; position:relative; top:-7px; left:-3px"></i>
                                        }
                                    </li>

                                </ul>

                            </li>

                            <li>
                                <span class="opener"><i class="fas fa-fist-raised" style="width:30px"></i> 挑戰</span>
                                <ul>

                                    <li><a href="~/FrontGift/GiftList" style="text-decoration:none"><i class="fas fa-pen-nib" style="width:30px"></i> 參加挑戰</a></li>
                                    <li><a href="~/FrontGift/GiftList" style="text-decoration:none"><i class="fas fa-running" style="width:30px"></i> 我的挑戰</a></li>
                                    <li><a href="~/FrontGift/GiftCart?userID=@Session["ID"]" style="text-decoration:none"><i class="fas fa-history" style="width:30px"></i> 過去挑戰</a></li>
                                    @if (Session["InProgram"] != null && (bool)Session["InProgram"])
                                    {
                                        <li><a href="~/ChatGroup/GroupChat" style="text-decoration:none"><i class="fas fa-sms" style="width:30px"></i>減重聊天群</a></li>
                                    }

                                </ul>

                            </li>
                        }

                        <li>
                            <span class="opener"><i class="fas fa-gifts" style="width:30px"></i> 禮物</span>
                            <ul>
                                <li><a href="~/FrontGift/GiftList" style="text-decoration:none"><i class="fas fa-gift" style="width:30px"></i> 禮物店</a></li>
                                @if (Session["ID"] != null)
                                {
                                    <li><a href="~/FrontGift/GiftCart?userID=@Session["ID"]" style="text-decoration:none"><i class="fas fa-shopping-cart" style="width:30px"></i> 已兌換禮物</a></li>
                                }

                            </ul>
                        </li>
                        <li>
                            <span class="opener"><i class="fas fa-file" style="width:30px"></i> 貼文</span>
                            <ul>
                                <li><a href="~/FrontPost/AllPosts" style="text-decoration:none"><i class="far fa-file" style="width:30px"></i> 所有貼文</a></li>
                                @if (Session["ID"] != null)
                                {

                                    <li><a href="~/FrontPost/UserPostList" style="text-decoration:none"><i class="fas fa-user-edit" style="width:30px"></i> 我的貼文</a></li>
                                }
                            </ul>
                        </li>
                        @if (Session["ID"] != null)
                        {
                            <li><a id="showContact" @*href="~/FrontContact/Chat"*@ style="text-decoration:none"><i class="fas fa-comments" style="width:30px"></i> 聯絡我們</a></li>
                        }

                        @if (Session["ID"] != null)
                        {
                            <li><a href="~/Admin/Login/Index" style="text-decoration:none"><i class="fas fa-user-cog" style="width:30px"></i> 後台</a></li>
                        }

                        @if (Session["ID"] != null)
                        {
                            <li><a href="~/Home2/Logout" style="text-decoration:none"><i class="fas fa-sign-out-alt" style="width:30px"></i> 登出</a></li>
                        }

                    </ul>
                </nav>



            </div>
        </div>



    </div>

    <!--dialog=======================================================-->
    <div id="dialogDiv"><ul></ul></div>
    <div id="programFrozen">
        挑戰已結束，請輸入目前體重<br />
        (還剩下&nbsp;<span style="color: #f56a6a"></span>&nbsp;天)：<br />
        <input type="text" id="resultWeight" placeholder="目前多重呢" autocomplete="off" />
        <label style="display:inline-block;font-size:1.2em">&nbsp;kg</label>
    </div>
    <div id="fanfare">
        恭喜您挑戰成功，獲得了：
        <div style="text-align:center"><span class="programSuccessPts"></span>&nbsp;點</div>
    </div>
    <!--=============================================================-->
    <!--CustomerService==============================================-->
    <div id="chatPanel" style="display:none">
        <div class="chatHeader">
            <div>聯絡客服：</div>
            <div id="notRead" class="button">
                <span></span>
            </div>
            <div id="collapse" class="button">
                <i class="fas fa-minus"></i>
            </div>
            <div id="closePanel" class="button">
                <i class="fas fa-times"></i>
            </div>
        </div>
        <div class="chatBody">
            <input type="hidden" id="serviceGroupId" />
            <!-- Conversations are loaded here -->
            <div id="serviceChatBox" class="direct-chat-messages scrollbar-outer service-chat-box">
            </div>
        </div>
        <div class="chatFooter">
            <input id="serviceMessage" type="text" name="message" placeholder="在此輸入訊息">
            <div id="sendmessage" class="button primary">送出</div>
        </div>
    </div>
    <!--=============================================================-->
    <!-- Scripts -->
    <script src="~/Content/js/jquery.min.js"></script>
    <script src="~/Content/js/browser.min.js"></script>
    <script src="~/Content/js/breakpoints.min.js"></script>
    <script src="~/Content/js/util.js"></script>
    <script src="~/Content/js/main.js"></script>
    <script src="~/Content/jquery-ui/jquery-ui-1.12.1.custom/jquery-ui.min.js"></script>
    <script src="~/Content/jquery-ui-scrollbar/jquery.scrollbar.min.js"></script>
    <script src="~/Scripts/jquery.signalR-2.4.2.min.js"></script>
    <script src="~/signalr/hubs"></script>

    @RenderSection("Scripts", required: false)


    <!--恩旗-->
    <script>
    $(window).on("unload", function () {
        $.cookies.del('.ASPXAUTH');
    });

    //=====================================================
    //恩旗
    //Show NoWeightLog dialog

    let notReadCount = 0;

    $(function () {
        var getPoints = @Json.Encode(Session["GotPoints"]);
        var noWeightLog = @Json.Encode(Session["NoWeightLog"]);
        var noPreferences = @Json.Encode(Session["NoPreferences"]);

        var programFrozen = @Json.Encode(Session["ProgramFrozen"]);

        var dialogShown = @Json.Encode(Session["dialogShown"]);
        var pointShown = @Html.Raw(Request.Cookies["PointShown"] == null ? "false" : Request.Cookies["PointShown"].Value);

        if (!pointShown && getPoints > 0) {
            let points = $("<span></span>").text(getPoints)
                .addClass("points");

            $("#dialogDiv > ul").append($("<li></li>").append("昨天共得到了", points, " 點！"));

        }

        if (!dialogShown && noWeightLog) {
            $("#dialogDiv > ul").append($("<li></li>").append("已經7天沒紀錄體重了"));
        }

        if (!dialogShown && noPreferences) {
            $("#dialogDiv > ul").append($("<li></li>").append("還沒選擇喜好的運動類型"));
        }

        if (!dialogShown && $("#dialogDiv > ul > li").length) {
            $("#dialogDiv").dialog({
                title: "提醒",
                modal: true,
                open: function (event, ui) {
                    $('.ui-dialog .btnOK').addClass("primary")
                        .css("padding", "10px").css("border-radius", "5px")
                        .css("outline-color", "white");
                    $(this).parent().focus();
                },
                dialogClass: "no-close",
                buttons: [{
                    text: "OK",
                    class: "btnOK",
                    click: function () {
                        $("#dialogDiv").dialog("close");
                        $.ajax({
                            url: "/Home2/SetDialogShownSession",
                            type: "POST"
                        });

                        if (programFrozen != null && programFrozen > -1) {
                            alertProgramFrozen(programFrozen);
                        }
                    }
                }]
            });

            //$('.ui-dialog button').blur();
            $('.ui-dialog button').mousedown(function (e) {
                e.preventDefault();
            });

        } else if (!dialogShown && programFrozen != null && programFrozen > -1) {
            alertProgramFrozen(programFrozen);
        }


        //====================================================
        //For CustomerService

        $(".scrollbar-outer").scrollbar();

        $.ajax({
            url: "/FrontContact/IsConnected",
            type: "POST"
        }).done(function (data) {
            if (data.IsConnected) {
                $("#chatPanel").css("display", "flex");
                connect();
            }
        });

        $("#collapse").click(function () {
            if ($("#collapse i.fa-minus").length != 0) {
                $(".chatBody").fadeOut(100, function () {
                    $("#chatPanel").animate({ height: 45 }, function () {
                        $(".chatFooter").fadeOut(0, function () {
                            $("#collapse i").removeClass("fas fa-minus").addClass("fas fa-plus");
                            $(".notReadText").remove();
                        });
                    });
                })
            } else {
                $("#chatPanel").animate({ height: 400 }, function () {
                    $(".chatFooter").fadeIn(600, function () {
                        $("#collapse i").removeClass("fas fa-plus").addClass("fas fa-minus");
                        $(".chatBody").fadeIn(function () {
                            if ($(".notReadText").length != 0) {
                                let chatBox = document.getElementById("serviceChatBox");
                                chatBox.scrollTop += $(".notReadText").position().top;
                            }
                            $("#notRead").css("visibility", "hidden");
                            notReadCount = 0;
                            SetNotReadCountSession(notReadCount);
                        });

                    });
                });
            }
        });

        $("#closePanel").click(function () {
            $("#chatPanel").css("display", "none");
        });

        $("#showContact").click(function () {
            $("#chatPanel").css("display", "flex");
            $.ajax({
                url: "/FrontContact/IsConnected",
                type: "POST"
            }).done(function (data) {
                if (!data.IsConnected) {
                    notReadCount = 0;
                    SetNotReadCountSession(notReadCount);
                    connect();
                }
            });
        });
        //=============================================================
    });

    function alertProgramFrozen(programFrozen) {
        $("#programFrozen span").text(programFrozen);
        $("#programFrozen").dialog({
            title: "提醒",
            modal: true,
            open: function (event, ui) {
                $('.ui-dialog .btnOK').addClass("primary")
                    .css("padding", "10px").css("border-radius", "5px")
                    .css("outline-color", "white");
                $(this).parent().focus();
            },
            dialogClass: "no-close",
            buttons: [{
                text: "確認",
                class: "btnOK",
                click: function () {

                    let patt = /^[0-9]+$/

                    if (!patt.test($("#resultWeight").val())) {
                        alert("請輸入有效體重");
                        return;
                    }

                    if (confirm("確定送出嗎？")) {

                        $.ajax({
                            url: "/Home2/SetResultWeight",
                            type: "POST",
                            data: {
                                resultWeight: $("#resultWeight").val()
                            },
                            success: function (results) {
                                fanfare(results);
                            }
                        });

                        $("#programFrozen").dialog("close");
                    }
                }
            },
            {
                text: "取消",
                class: "btnOK",
                click: function () {
                    $("#programFrozen").dialog("close");
                    $.ajax({
                        url: "/Home2/SetDialogShownSession",
                        type: "POST"
                    });
                }
            }]
        });

        $('.ui-dialog button').mousedown(function (e) {
            e.preventDefault();
        });
    }

    function fanfare(results) {

        if ($("#weightNotify").length) {
            $("#weightNotify").remove();
        }

        $("#fanfare .programSuccessPts").prepend(results.GetPoints);
        $("#fanfare").dialog({
            title: "恭喜您",
            modal: true,
            open: function (event, ui) {
                $('.ui-dialog .btnOK').addClass("primary")
                    .css("padding", "10px").css("border-radius", "5px")
                    .css("outline-color", "white");
                $(this).parent().focus();
            },
            dialogClass: "no-close",
            buttons: [{
                text: "收下",
                class: "btnOK",
                click: function () {
                    $("#fanfare").dialog("close");
                }
            }]
        });

        //$('.ui-dialog button').blur();
        $('.ui-dialog button').mousedown(function (e) {
            e.preventDefault();
        });
    }

    //===================================================

    function connect() {

        var chat = $.connection.chatHub;

        chat.client.receive = function (connId, userName, message, timeStamp, image, groupId) {

            if ($("#collapse i.fa-minus").length == 0) {
                if (notReadCount == 0) {
                    appendNotRead();
                }
                writeForService(userName, message, $.connection.hub.id == connId, timeStamp, image)

                //=============================================
                notReadCount++;
                SetNotReadCountSession(notReadCount);
                $("#notRead span").text(notReadCount);
                //==============================================
                $("#notRead").css("visibility", "visible")
                blink();
            } else {
                writeForService(userName, message, $.connection.hub.id == connId, timeStamp, image)
                let chatBox = document.getElementById("serviceChatBox");
                chatBox.scrollTop = chatBox.scrollHeight;
            }
        }

        $.connection.hub.start().done(function () {
            $.ajax({
                url: "/FrontContact/AddToServiceGroup",
                type: "POST",
                data: {
                    connId: $.connection.hub.id
                }
            }).done(function (data) {
                alert(data.Result);
                $("#serviceGroupId").val(data.GroupId);
                LoadMessagesForService(@Json.Encode(Session["NotReadCount"]));
                notReadCount = 0;
                SetNotReadCountSession(notReadCount);
            });

            $("#sendmessage").click(function () {

                if ($("#message").val() == "") {
                    alert("請輸入訊息");
                    return;
                }

                $.ajax({
                    url: "/FrontContact/SendMessage",
                    type: "POST",
                    data: {
                        connId: $.connection.hub.id,
                        groupId: $("#serviceGroupId").val(),
                        message: $("#serviceMessage").val()
                    }
                });
            });

        });
    }

    function writeForService(userName, message, isSelf, timeStamp, image) {

        if (isSelf) {
            let dialogDiv = $("<div></div>").addClass("messageRow");

            $("<div></div>").css("flex-basis", "100%")
                .append($("<span></span>").css("float", "left").text(userName))
                .append($("<span></span>").css("float", "right").text(timeStamp))
                .appendTo(dialogDiv);

            $("<img/>").addClass("myImage")
                .attr("src", "/Areas/Admin/Content/UserImage/" + image)
                .appendTo(dialogDiv);

            $("<div></div>").addClass("selfText").css("margin-right", "auto")
                .css("background-color", "plum").css("color", "white").css("border-color", "plum")
                .html(message)
                .appendTo(dialogDiv);

            $("#serviceChatBox").append(dialogDiv);


        } else {
            let dialogDiv = $("<div></div>").addClass("messageRow");;

            $("<div></div>").css("flex-basis", "100%")
                .append($("<span></span>").css("float", "right").text(userName))
                .append($("<span></span>").css("float", "left").text(timeStamp))
                .appendTo(dialogDiv);

            $("<div></div>").addClass("otherText").css("margin-left", "auto")
                .css("background-color", "#f56a6a").css("color", "white").css("border-color", "#f56a6a")
                .html(message)
                .appendTo(dialogDiv);

            $("<img/>").addClass("myImage")
                .attr("src", "/Areas/Admin/Content/UserImage/" + image)
                .appendTo(dialogDiv);

            $("#serviceChatBox").append(dialogDiv);


        }

    }

    //todo Load Group Messages
    function LoadMessagesForService(notReadCount) {
        if ($("#serviceGroupId").val() != "") {
            $.ajax({
                url: "/FrontContact/GetGroupMsgs",
                type: "POST",
                data: {
                    groupId: $("#serviceGroupId").val()
                },
                success: function (data) {

                    $("#serviceChatBox").html("");

                    $.each(data, function (i, msg) {
                        if (i == (data.length - notReadCount)) {
                            appendNotRead();
                        }
                        writeForService(msg.userName, msg.message, $.connection.hub.id == msg.connId, msg.timeStamp, msg.image);

                    });

                    if ($(".notReadText").length != 0) {
                        let chatBox = document.getElementById("serviceChatBox");
                        chatBox.scrollTop += $(".notReadText").position().top;
                    }
                }
            });
        }
    }

    function SetNotReadCountSession(notReadCount)
    {
        $.ajax({
            url: "/FrontContact/SetNotReadCountSession",
            type: "POST",
            data: {
                notReadCount: notReadCount
            }
        });
    }

    function blink() {
        $("#notRead").fadeOut(500).fadeIn(500, blink);
    }

    function appendNotRead() {

        let NotReadDiv = $("<div></div>").addClass("notReadText").append("以下為未讀訊息");

        $("#serviceChatBox").append(NotReadDiv);
    }
    </script>
</body>
</html>